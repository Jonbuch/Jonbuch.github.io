<!DOCTYPE html>
<html lang="en">
<head>
	<meta charset="utf-8">
	<title>D3: Test of formatted axis values</title>
	<script type="text/javascript" src="../d3/d3.js"></script>
	<style type="text/css">

		.axis path,
		.axis line {
			fill: none;
			stroke: black;
			shape-rendering: crispEdges;
		}

		.axis text {
			font-family: sans-serif;
			font-size: 11px;
		}
	</style>
</head>

<body>
	<a href="index.html" title="index">Go back to index</a>
	<br>
	<br>

	<p>Click on the blue square to toggle between years</p>

	<script type="text/javascript">
// <a href="index.html" title="week7">Go to index</a>
		var w = 800;
		var h = 600;
		var padding = 80;

		var dataTrial = [
			{name: 'NORTHERN', values: [0,0], size : 0},
			{name: 'INGLESIDE', values: [0,0], size : 0},
			{name: 'TENDERLOIN', values: [0,0], size : 0},
			{name: 'CENTRAL', values: [0,0], size : 0},
			{name: 'BAYVIEW', values: [0,0], size : 0},
			{name: 'MISSION', values: [0,0], size : 0},
			{name: 'PARK', values: [0,0], size : 0},
			{name: 'RICHMOND', values: [0,0], size : 0},
			{name: 'SOUTHERN', values: [0,0], size : 0},
			{name: 'TARAVAL', values: [0,0], size : 0}
		];

		var dataset = [];
		var datafileName = "data_2003.csv";
		var currentYear = "2003";
		var xScaleGlobal;
		var yScaleGlobal;
		var xAxisGlobal;
		var yAxisGlobal;

		var displayYearGlobal;


		//Create SVG element
		var svg = d3.select("body")
			.append("svg")
			.attr("width", w)
			.attr("height", h);

/*
		d3.csv("data_2003_small.csv", function(d) {
			dataset = d;
			parseData(dataset);
			visualizeData(dataTrial);
    	});
*/
    	d3.csv(datafileName, function(d) {
			dataset = d;
			parseData(dataset);
			visualizeData(dataTrial);
    	});


		function parseData(inputData) {
    		for( var i = 0; i <inputData.length; i++){
				if(inputData[i].PdDistrict == 'NORTHERN'){
					dataTrial[0].size +=1;
					if(inputData[i].Category == 'PROSTITUTION'){
						dataTrial[0].values[0] +=1;
					}
					if(inputData[i].Category == 'LARCENY/THEFT'){
						dataTrial[0].values[1] +=1;
					}
				}
				if(inputData[i].PdDistrict == 'INGLESIDE'){
					dataTrial[1].size +=1;
					if(inputData[i].Category == 'PROSTITUTION'){
						dataTrial[1].values[0] +=1;
					}
					if(inputData[i].Category == 'LARCENY/THEFT'){
						dataTrial[1].values[1] +=1;
					}
				}
				if(inputData[i].PdDistrict == 'TENDERLOIN'){
					dataTrial[2].size +=1;
					if(inputData[i].Category == 'PROSTITUTION'){
						dataTrial[2].values[0] +=1;
					}
					if(inputData[i].Category == 'LARCENY/THEFT'){
						dataTrial[2].values[1] +=1;
					}
				}
				if(inputData[i].PdDistrict == 'CENTRAL'){
					dataTrial[3].size +=1;
					if(inputData[i].Category == 'PROSTITUTION'){
						dataTrial[3].values[0] +=1;
					}
					if(inputData[i].Category == 'LARCENY/THEFT'){
						dataTrial[3].values[1] +=1;
					}
				}
				if(inputData[i].PdDistrict == 'BAYVIEW'){
					dataTrial[4].size +=1;
					if(inputData[i].Category == 'PROSTITUTION'){
						dataTrial[4].values[0] +=1;
					}
					if(inputData[i].Category == 'LARCENY/THEFT'){
						dataTrial[4].values[1] +=1;
					}
				}
				if(inputData[i].PdDistrict == 'MISSION'){
					dataTrial[5].size +=1;
					if(inputData[i].Category == 'PROSTITUTION'){
						dataTrial[5].values[0] +=1;
					}
					if(inputData[i].Category == 'LARCENY/THEFT'){
						dataTrial[5].values[1] +=1;
					}
				}
				if(inputData[i].PdDistrict == 'PARK'){
					dataTrial[6].size +=1;
					if(inputData[i].Category == 'PROSTITUTION'){
						dataTrial[6].values[0] +=1;
					}
					if(inputData[i].Category == 'LARCENY/THEFT'){
						dataTrial[6].values[1] +=1;
					}
				}
				if(inputData[i].PdDistrict == 'RICHMOND'){
					dataTrial[7].size +=1;
					if(inputData[i].Category == 'PROSTITUTION'){
						dataTrial[7].values[0] +=1;
					}
					if(inputData[i].Category == 'LARCENY/THEFT'){
						dataTrial[7].values[1] +=1;
					}
				}
				if(inputData[i].PdDistrict == 'SOUTHERN'){
					dataTrial[8].size +=1;
					if(inputData[i].Category == 'PROSTITUTION'){
						dataTrial[8].values[0] +=1;
					}
					if(inputData[i].Category == 'LARCENY/THEFT'){
						dataTrial[8].values[1] +=1;
					}
				}
				if(inputData[i].PdDistrict == 'TARAVAL'){
					dataTrial[9].size +=1;
					if(inputData[i].Category == 'PROSTITUTION'){
						dataTrial[9].values[0] +=1;
					}
					if(inputData[i].Category == 'LARCENY/THEFT'){
						dataTrial[9].values[1] +=1;
					}
				}
			}
		}	

		var toggleButton = svg.append("rect")
    		.attr("x", 5)
    		.attr("y", h/50)
    		.attr("width", 40)
    		.attr("height", 40)
    		.attr("fill", "blue");


		function visualizeData(inputArray) {
			var xScale = d3.scale.linear()
								 .domain([0, d3.max(inputArray, function(d) { return d.values[0]; })])
								 .range([padding, w - padding * 2]);
			var yScale = d3.scale.linear()
								 .domain([0, d3.max(inputArray, function(d) { return d.values[1]+6000; })])
								 .range([h - padding, padding]);
			//Define X axis
			var xAxis = d3.svg.axis()
							  .scale(xScale)
							  .orient("bottom")
							  .ticks(10);
			//Define Y axis
			var yAxis = d3.svg.axis()
							  .scale(yScale)
							  .orient("left")
							  .ticks(10);

			xScaleGlobal = xScale;
			yScaleGlobal = yScale;
			xAxisGlobal = xAxis;
			yAxisGlobal = yAxis;

			// create cirlces
			svg.selectAll("circle")
				.data(inputArray)
				.enter()
				.append("circle")
				.attr("cx", function(d) {
					return xScale(d.values[0]);
				})
				.attr("cy", function(d,i) {
					return yScale(d.values[1]);
				})
				.attr("r", function(d,i) {
					return d.size*0.001 ;
			});

			//Create labels
			svg.selectAll("text")
				.data(inputArray)
				.enter()
				.append("text")
				.text(function(d) {
					//return d.name + " "+d.values[0] + "," + d.values[1];
					return d.name;
				})
				.attr("x", function(d) {
					return xScale(d.values[0])+d.size*0.001;
				})
				.attr("y", function(d) {
					return yScale(d.values[1]);
				})
				.attr("font-family", "sans-serif")
				.attr("font-size", "11px")
				.attr("fill", "red");


			//Create X axis
			svg.append("g")
				.attr("class", "axis")
				.attr("transform", "translate(0," + (h - padding) + ")")
				.call(xAxis);
			
			//Create Y axis
			svg.append("g")
				.attr("class", "axis")
				.attr("transform", "translate(" + padding + ",0)")
				.call(yAxis);


			svg.append("text")
        		.attr("y", h-40)
        		.attr("x",w/2-30)
        		.attr("dy", "1em")
        		.style("text-anchor", "middle")
        		.text("PROSTITUTION");
			svg.append("text")
        		.attr("transform", "rotate(-90)")
        		.attr("y", 10)
        		.attr("x",0 - (h / 2))
        		.attr("dy", "1em")
        		.style("text-anchor", "middle")
        		.text("LARCENY / THEFT");

        	svg.append("text")
        		.attr("y", 40)
        		.attr("x",w/2-30)
        		.attr("dy", "1em")
        		.style("text-anchor", "middle")
        		.text("San Francisco Crime in districts");
        	var displayYear = svg.append("text")
        		.attr("y", 60)
        		.attr("x",w/2-30)
        		.attr("dy", "1em")
        		.style("text-anchor", "middle")
        		.text(currentYear);
        	displayYearGlobal = displayYear;

		}
		function reVisualizeData(inputArray) {

			var xAxis = d3.svg.axis()
							  .scale(xScaleGlobal)
							  .orient("bottom")
							  .ticks(10);
			//Define Y axis
			var yAxis = d3.svg.axis()
							  .scale(yScaleGlobal)
							  .orient("left")
							  .ticks(10);
			// create cirlces
			svg.selectAll("circle")
				.data(inputArray)
				.transition()
				.attr("cx", function(d) {
					return xScaleGlobal(d.values[0]);
				})
				.attr("cy", function(d,i) {
					return yScaleGlobal(d.values[1]);
				})
				.attr("r", function(d,i) {
					return d.size*0.001 ;
			});

			//Create labels
			svg.selectAll("text")
				.data(inputArray)
				.transition()
				.text(function(d) {
					return d.name;
				})
				.attr("x", function(d) {
					return xScaleGlobal(d.values[0])+d.size*0.001;
				})
				.attr("y", function(d) {
					return yScaleGlobal(d.values[1]);
				})
				.attr("font-family", "sans-serif")
				.attr("font-size", "11px")
				.attr("fill", "red");


			//Create X axis
			svg.append("g")
				.attr("class", "axis")
				.attr("transform", "translate(0," + (h - padding) + ")")
				.call(xAxis);
			
			//Create Y axis
			svg.append("g")
				.attr("class", "axis")
				.attr("transform", "translate(" + padding + ",0)")
				.call(yAxis);

			displayYearGlobal
				.text(currentYear);

		}
		
		d3.select("rect")
				.on("click", function() {
					if (currentYear == "2003"){
						datafileName = "data_2015.csv";
						currentYear = "2015";
					}
					else{
						datafileName = "data_2003.csv";
						currentYear = "2003";
					}
					
					dataTrial = [
						{name: 'NORTHERN', values: [0,0], size : 0},
						{name: 'INGLESIDE', values: [0,0], size : 0},
						{name: 'TENDERLOIN', values: [0,0], size : 0},
						{name: 'CENTRAL', values: [0,0], size : 0},
						{name: 'BAYVIEW', values: [0,0], size : 0},
						{name: 'MISSION', values: [0,0], size : 0},
						{name: 'PARK', values: [0,0], size : 0},
						{name: 'RICHMOND', values: [0,0], size : 0},
						{name: 'SOUTHERN', values: [0,0], size : 0},
						{name: 'TARAVAL', values: [0,0], size : 0}
					];

					d3.csv(datafileName, function(d) {
						dataset = d;
						parseData(dataset);
						reVisualizeData(dataTrial);
    				});
		});

			</script>
		</body>
		</html>